
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Selecting the number of components in PARAFAC models &#8212; TLViz 0.1.3 documentation</title> 
<link rel="stylesheet" href="../_static/tensorly_style.css">
<link rel="apple-touch-icon" sizes="180x180" href="../_static/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../_static/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../_static/favicon/favicon-16x16.png">
<link rel="manifest" href="../_static/favicon/site.webmanifest">
<link rel="mask-icon" href="../_static/favicon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../_static/favicon/favicon.ico">
<meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tensorly_style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />

  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
 <script src="../_static/navbar_burger.js"></script>
 <script defer src="https://use.fontawesome.com/releases/v5.14.0/js/all.js"></script>
 
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Outlier detection with PARAFAC" href="plot_outlier_detection.html" />
    <link rel="prev" title="Optimisation diagnostics with PARAFAC models" href="plot_optimisation_diagnostic.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  </head>
<body  class="has-navbar-fixed-top">

  <header>
    <navbar>
      <nav class="navbar top-navbar is-fixed-top has-shadow is-flex-wrap-wrap" role="navigation" aria-label="main top navigation">
        <div class="navbar-brand">
        <!-- Always displayed, last item has to be navbar-burger -->

          <a class="navbar-item" href="../index.html">
            <img src="../_static/tlviz_logo.svg" height="28">
          </a>

          <!-- <a class="navbar-item is-hidden-desktop" href="../index.html">
            <span class="icon"><i class="fa fa-home" aria-hidden="true"></i></span>
          </a> -->
          <a class="navbar-item is-hidden-desktop" href="https://github.com/tensorly/viz" target="_blank">
              <span class="icon"><i class="fab fa-github"></i></span>
          </a>

          <a role="button" class="navbar-burger" data-target="top-nav-menu" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>

        </div>
        
        <div class="navbar-menu" id="top-nav-menu">
        <!-- only on larger displays (> 1024px) -->

          <div class="navbar-start">
          <!-- RIGHT -->
            <a class="navbar-item" href="../about_tensors.html">
              Introduction
            </a>
            <a class="navbar-item" href="../installation.html">
              Installation
            </a>
            <a class="navbar-item" href="index.html">
              Examples
            </a>
            <a class="navbar-item" href="../api.html">
              API
            </a>
            <a class="navbar-item" href="https://tensorly.org" target="_blank">
              TensorLy
            </a>

          </div>
        
          <div class="navbar-end">
            <div class="navbar-item">
            <!-- LEFT -->

            <!-- <a class="navbar-item is-hidden-touch" href="../index.html">
              <span class="icon-text">
                <span class="icon">
                  <i class="fa fa-home"></i>
                </span>
                <span>Home</span>
              </span>
              <span class="icon"><i class="fa fa-home" aria-hidden="true"></i></span>
            </a> -->
            <a class="button is-hidden-touch is-dark" href="https://github.com/tensorly/viz" target="_blank">
              <span class="icon-text">
                <span class="icon is-large">
                  <i class="fab fa-github"></i>
                </span>
                <span>Github</span>
              </span>
                <!-- <span class="icon"><i class="fab fa-github"></i></span> -->
            </a>

            </div> <!-- navbar item -->
          </div> <!-- navbar end -->
        </div> <!-- only large items -->

      </nav>
      
    </navbar>
  </header>

  <div id="column-container">
  <div class="columns is-mobile is-centered">
	
      <div class="column is-10-mobile is-one-third-tablet is-3-desktop is-hidden-mobile" id="sidebar">
    <!-- Side menu  -->
    <aside class="sticky-nav sidebar-menu">
<div class="sidebar-search">
  <form class="field" id="searchbox" role="search" action="../search.html" method="get">
    <!-- <label class="label" id="searchlabel">Quick search</label> -->
    <div class="field has-addons">
      <div class="control is-expanded">
        <input class="input" type="text" placeholder="Search in TLViz" name="q" aria-labelledby="searchlabel">
      </div>
      <div class="control">
        <input class="button is-info" type="submit" value="Go" />
      </div>
    </div>
  </form>
  <script>$('#searchbox').show(0);</script>
  <script>
  $(document).ready(function() {
    Document.highlightSearchWords = function() {
      var params = $.getQueryParameters();
      var terms = (params.highlight) ? params.highlight[0].split(/\s+/) : [];
      if (terms.length) {
        var body = $('div.body');
        if (!body.length) {
          body = $('body');
        }
        window.setTimeout(function() {
          $.each(terms, function() {
            body.highlightText(this.toLowerCase(), 'highlighted');
          });
        }, 10);
        $('<p class="highlight-link"><a href="javascript:Documentation.' +
          'hideSearchWords()">' + _('Hide All')
          + '<span class="tag is-delete"></span>'
          + '</a></p>')
            .appendTo($('#searchbox'));
      }
    };
  });
  </script>
</div>
      
      <div class="sidebar-menu-toc">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_tensors.html">What are tensors and tensor decompositions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Gallery of examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_labelled_decompositions.html">Labelled decompositions</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_working_with_xarray.html">Working with xarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_core_consistency.html">Core consistency</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_bike_plotly.html">TLViz + PlotLy for interactive visualisations</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_split_half_analysis.html">Split-half analysis for selecting the number of components</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_optimisation_diagnostic.html">Optimisation diagnostics with PARAFAC models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Selecting the number of components in PARAFAC models</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_outlier_detection.html">Outlier detection with PARAFAC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensorly_backends.html">Working with TensorLy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>
 
      </div>
    </aside>
  </div>
  

    <div class="column main-column">

      <!-- Main content  -->
      <section class="main-section">

        <!-- Toggle menu button -->
		
        <div class="side-menu-toggle">
          <button class="button" id="toggle-sidebar" onclick="toggle_sidebar()">
            <span class="icon"><i class="fa fa-bars" aria-hidden="true"></i></span>
            <span>menu</span> 
          </button>
        </div>
        

        <div class="content main-content">
          
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-selecting-aminoacids-components-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="selecting-the-number-of-components-in-parafac-models">
<span id="sphx-glr-auto-examples-plot-selecting-aminoacids-components-py"></span><h1>Selecting the number of components in PARAFAC models<a class="headerlink" href="#selecting-the-number-of-components-in-parafac-models" title="Permalink to this headline">¶</a></h1>
<p>In this example, we will look at some methods for selecting the number of components for a PARAFAC model.</p>
<section id="imports-and-utilities">
<h2>Imports and utilities<a class="headerlink" href="#imports-and-utilities" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tensorly.decomposition</span> <span class="kn">import</span> <span class="n">parafac</span>

<span class="kn">import</span> <span class="nn">tlviz</span>
</pre></div>
</div>
<p>To fit PARAFAC models, we need to solve a non-convex optimization problem, possibly with local minima. It is
therefore useful to fit several models with the same number of components using many different random
initialisations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit_many_parafac</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">num_components</span><span class="p">,</span> <span class="n">num_inits</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">parafac</span><span class="p">(</span>
            <span class="n">X</span><span class="p">,</span>
            <span class="n">num_components</span><span class="p">,</span>
            <span class="n">n_iter_max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
            <span class="n">init</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
            <span class="n">orthogonalise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">linesearch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_inits</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="loading-the-data">
<h2>Loading the data<a class="headerlink" href="#loading-the-data" title="Permalink to this headline">¶</a></h2>
<p>Here we load the <a class="reference external" href="http://models.life.ku.dk/Amino_Acid_fluo">Aminoacids dataset</a> from <span id="id1">[<a class="reference internal" href="../references.html#id10" title="Rasmus Bro. Parafac. tutorial and applications. Chemometrics and intelligent laboratory systems, 38(2):149–171, 1997.">Bro97</a>]</span>
and plot the EEM-matrix for each of the five samples.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aminoacids</span> <span class="o">=</span> <span class="n">tlviz</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load_aminoacids</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aminoacids</span><span class="p">):</span>
    <span class="n">sample</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_001.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_001.png" alt="Sample = 0, Sample = 1, Sample = 2, Sample = 3, Sample = 4" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Loading Aminoacids dataset from:
Bro, R, PARAFAC: Tutorial and applications, Chemometrics and Intelligent Laboratory Systems, 1997, 38, 149-171
</pre></div>
</div>
</section>
<section id="fit-models">
<h2>Fit models<a class="headerlink" href="#fit-models" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> components&quot;</span><span class="p">)</span>
    <span class="n">models</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_many_parafac</span><span class="p">(</span><span class="n">aminoacids</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">num_inits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>1 components
2 components
3 components
4 components
5 components
</pre></div>
</div>
</section>
<section id="sort-the-initialisation-by-their-sse">
<h2>Sort the initialisation by their SSE<a class="headerlink" href="#sort-the-initialisation-by-their-sse" title="Permalink to this headline">¶</a></h2>
<p>For each rank, we pick the initialization run that achieved the lowest reconstruction error.
To do this, we first sort each initialization run by its final relative sum squared error (rel. SSE).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">inits</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">sorted_inits</span><span class="p">,</span> <span class="n">sorted_errors</span> <span class="o">=</span> <span class="n">tlviz</span><span class="o">.</span><span class="n">multimodel_evaluation</span><span class="o">.</span><span class="n">sort_models_by_error</span><span class="p">(</span><span class="n">inits</span><span class="p">,</span> <span class="n">aminoacids</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">models</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_inits</span>
    <span class="n">errors</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_errors</span>

<span class="n">selected_models</span> <span class="o">=</span> <span class="p">{</span><span class="n">rank</span><span class="p">:</span> <span class="n">inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">inits</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</section>
<section id="examine-model-uniqueness">
<h2>Examine model uniqueness<a class="headerlink" href="#examine-model-uniqueness" title="Permalink to this headline">¶</a></h2>
<p>To examine whether we have found the global minimum, we compare each initialization run with the initialization
run that achieved the lowest rel. SSE. Ideally, we want the initialization runs to have reached the same point,
and if that is the case, they should have the same rel. SSE and similar components. To measure the component
similarity, we use the factor match score (FMS), similar to the cosine similarity score. An FMS value of 1 indicates
that the components are equivalent. The FMS is given by</p>
<div class="math notranslate nohighlight">
\[\text{FMS} = \frac{1}{R}
\sum_{r=1}^R
   \left(1 - \frac{|w_r - \hat{w}_r|}{\max(w_r, \hat{w}_r)}\right)
   \frac{\mathbf{a}_r^\mathsf{T}\hat{\mathbf{a}}_r}{\|\mathbf{a}_r\|\|\hat{\mathbf{a}}_r\|}
   \frac{\mathbf{b}_r^\mathsf{T}\hat{\mathbf{b}}_r}{\|\mathbf{b}_r\|\|\hat{\mathbf{b}}_r\|}
   \frac{\mathbf{c}_r^\mathsf{T}\hat{\mathbf{c}}_r}{\|\mathbf{c}_r\|\|\hat{\mathbf{c}}_r\|},\]</div>
<p>where the the parameters without a hat correspond the the parameters of the reference decomposition.
<span class="math notranslate nohighlight">\(w\)</span> represents the weight of the decompositions, and <span class="math notranslate nohighlight">\(\mathbf{a}_r, \mathbf{b}_r\)</span> and
<span class="math notranslate nohighlight">\(\mathbf{c}_r\)</span> represents the <span class="math notranslate nohighlight">\(r\)</span>-th component vectors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fms_with_selected</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">inits</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">fms_with_selected</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span> <span class="o">=</span> <span class="n">tlviz</span><span class="o">.</span><span class="n">multimodel_evaluation</span><span class="o">.</span><span class="n">similarity_evaluation</span><span class="p">(</span><span class="n">inits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inits</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="plot-uniqueness-information">
<h2>Plot uniqueness information<a class="headerlink" href="#plot-uniqueness-information" title="Permalink to this headline">¶</a></h2>
<p>A visual way to examine the uniqueness is to plot the rel. SSE on one axis and the FMS with selected initialization
on the other axis for each initialization run. We create one such plot for each rank to compare different choices of
rank</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fms_with_selected</span><span class="p">[</span><span class="n">rank</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="n">rank</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> components&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;FMS with best&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative SSE&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_002.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_002.png" alt="1 components, 2 components, 3 components, 4 components, 5 components" class = "sphx-glr-single-img"/><p>From this plot, we see that for 1-3 components, all initialization runs seem to achieve the same rel. SSE and
similar components. This similarity indicates that the models are unique. However, for 4-5 components, we see
that the “FMS with best” value is low, which means that the selected initialization run is quite different from
the rest. This difference indicates that we either have a non-unique model or problems with local minima. Therefore,
if we decide to go with the four or five component models, we should run even more initializations to ensure that
we can get the same components for more than just one initialization.</p>
</section>
<section id="scree-plot-of-fit-and-core-consistency">
<h2>Scree plot of fit and core consistency<a class="headerlink" href="#scree-plot-of-fit-and-core-consistency" title="Permalink to this headline">¶</a></h2>
<p>Another common strategy for determining the number of components is the fit and core consistency diagnostic. The fit
measures how well the model describes the data. By plotting this value for each rank choice, we can see how much
additional components improve the model fit. We are looking for a “shoulder” where the fit increase slows down,
indicating that the added complexity of a higher rank model does not actually add much in terms of modelling
the data.</p>
<p>The core consistency measure “interaction” between the components of the model. The PARAFAC model assumes
multi-linearity, which means that the components don’t interact, and the uniqueness of PARAFAC stems from this
assumption. A low core consistency value means that allowing for component interaction could improve the model’s fit,
which indicates that the components are modelling behavior that is not multilinear. Therefore, the core consistency
can be a good metric for selecting the number of components as a drop in core consistency can indicate that you have
added too many components and started modelling noise or patterns that do not satisfy the multilinearity assumption
of PARAFAC. However, the PARAFAC model can be useful even if the data does not follow the multilinearity assumption.
Hence, a low core consistency alone is not necessarily a bad sign.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">tlviz</span><span class="o">.</span><span class="n">visualisation</span><span class="o">.</span><span class="n">scree_plot</span><span class="p">(</span><span class="n">selected_models</span><span class="p">,</span> <span class="n">aminoacids</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tlviz</span><span class="o">.</span><span class="n">visualisation</span><span class="o">.</span><span class="n">scree_plot</span><span class="p">(</span><span class="n">selected_models</span><span class="p">,</span> <span class="n">aminoacids</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;Core consistency&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">105</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_003.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_003.png" alt="plot selecting aminoacids components" class = "sphx-glr-single-img"/></section>
<section id="core-element-plot">
<h2>Core element plot<a class="headerlink" href="#core-element-plot" title="Permalink to this headline">¶</a></h2>
<p>The core element plot shows the elements of the core tensor. Ideally “Superdiagonal” entries should be 1 and
off-diagonal entries should be zero which means no interaction.</p>
<p>One thing to note is that as the number of components increases, so does the number of possible interactions.
So models with a high number of components are more likely to be improved by allowing interactions than models
with a low number of components. Thus, the core consistency is a less precise metric if you expect your data
needs a high number of components.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_models</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> components&quot;</span><span class="p">)</span>
    <span class="n">tlviz</span><span class="o">.</span><span class="n">visualisation</span><span class="o">.</span><span class="n">core_element_plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">aminoacids</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_004.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_004.png" alt="Core consistency: 100.0, Core consistency: 100.0, Core consistency: 99.1, Core consistency: -2670218.5, Core consistency: -1211539713761016.0" class = "sphx-glr-single-img"/><p>For more information about the core consistency and core element plot, see the
<a class="reference internal" href="plot_core_consistency.html#core-consistency"><span class="std std-ref">core consistency example</span></a>.</p>
</section>
<section id="split-half-analysis">
<h2>Split-half analysis<a class="headerlink" href="#split-half-analysis" title="Permalink to this headline">¶</a></h2>
<p>Another way to select the number of components is with <em>split-half analysis</em>. With split-half analysis, we
divide the dataset in to along one mode, and fit two different models, one for each split. Then, we compare
the similarity of the decomposition for the modes where we did not perform the split.</p>
<p>For split-half analysis, it is important to choose a split that makes sense. We need to expect that all
components will be present in both splits! In this case, we only have five samples, and reducing the number
of samples even further can make it difficult to find the correct decomposition. We will therefore not use
split-half analysis here. Instead, we have devoted a <a class="reference internal" href="plot_split_half_analysis.html#split-half"><span class="std std-ref">separate example for split-half analysis</span></a>.</p>
</section>
<section id="component-plots">
<h2>Component plots<a class="headerlink" href="#component-plots" title="Permalink to this headline">¶</a></h2>
<p>When deciding the number of components, the most important consideration is the components themselves.
It is therefore essential to visualize the components and evaluate whether they are meaningful in terms
of the application</p>
<section id="components">
<h3>3 components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_3comp</span> <span class="o">=</span> <span class="n">tlviz</span><span class="o">.</span><span class="n">postprocessing</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">selected_models</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">dataset</span><span class="o">=</span><span class="n">aminoacids</span><span class="p">)</span>
<span class="n">tlviz</span><span class="o">.</span><span class="n">visualisation</span><span class="o">.</span><span class="n">components_plot</span><span class="p">(</span><span class="n">model_3comp</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_005.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_005.png" alt="plot selecting aminoacids components" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tlviz</span><span class="o">.</span><span class="n">visualisation</span><span class="o">.</span><span class="n">percentage_variation_plot</span><span class="p">(</span><span class="n">model_3comp</span><span class="p">,</span> <span class="n">aminoacids</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_006.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_006.png" alt="plot selecting aminoacids components" class = "sphx-glr-single-img"/></section>
<section id="id2">
<h3>4 components<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_4comp</span> <span class="o">=</span> <span class="n">tlviz</span><span class="o">.</span><span class="n">postprocessing</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">selected_models</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">dataset</span><span class="o">=</span><span class="n">aminoacids</span><span class="p">)</span>
<span class="n">tlviz</span><span class="o">.</span><span class="n">visualisation</span><span class="o">.</span><span class="n">components_plot</span><span class="p">(</span><span class="n">model_4comp</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_007.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_007.png" alt="plot selecting aminoacids components" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tlviz</span><span class="o">.</span><span class="n">visualisation</span><span class="o">.</span><span class="n">percentage_variation_plot</span><span class="p">(</span><span class="n">model_4comp</span><span class="p">,</span> <span class="n">aminoacids</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_selecting_aminoacids_components_008.png" srcset="../_images/sphx_glr_plot_selecting_aminoacids_components_008.png" alt="plot selecting aminoacids components" class = "sphx-glr-single-img"/><p>We see that the four-component model consists of three clear chemical spectra, which coincides well with our
knowledge about the data. The data is samples from mixtures of three different aminoacids. The sample-mode
component shows the concentration of each chemicaland the emission- and excitation-mode components show the
emission- and excitation-spectra of the chemicals (all in arbitrary units). With more than three components,
we find that one of the components have negative, and therefore unphysical, components.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  13.198 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-selecting-aminoacids-components-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/98929c246383aff86d593be63ad84c4a/plot_selecting_aminoacids_components.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_selecting_aminoacids_components.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/4107cb60032dcd50fe9ace71e85d09ef/plot_selecting_aminoacids_components.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_selecting_aminoacids_components.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>
</section>


        </div>

		
        <nav class="pagination" role="navigation" aria-label="pagination">
    
    <a class="button is-medium pagination-previous" href="plot_optimisation_diagnostic.html" title="previous page" accesskey="p">
        <span class="icon">
            <i class="fa fa-arrow-circle-left"></i>
        </span>
        <span>Optimisation diagnostics with PARAFAC models</span>
    </a>
    
    
    <a class="button is-medium pagination-next" href="plot_outlier_detection.html" title="next page" accesskey="n">
        <span>Outlier detection with PARAFAC </span>
        <span class="icon">
            <i class="fa fa-arrow-circle-right"></i>
        </span>
    </a>
    
</nav>

        

      </section>

        <footer class="footer">
    <div class="content has-text-centered">
        <div class="block">
          &copy; Copyright 2021, Marie Roald &amp; Yngve Mardal Moe.<br/>
        </div>
      <div class="block">
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> and the <a href="tensorly.org"><strong>TensorLy</strong></a> theme by <a href="jeankossaifi.com">Jean Kossaifi</a>.
      </div>
    </div>
  </footer>

    </div>

	
    
    <div class="column is-hidden-touch is-2-desktop is-one-fifth-widescreen" id="localtoc-column">

    <aside class="sticky-nav localtoc">  
        <div class="menu menu-list">
        <p class="menu-label">On this page</p>
        <ul>
<li><a class="reference internal" href="#">Selecting the number of components in PARAFAC models</a><ul>
<li><a class="reference internal" href="#imports-and-utilities">Imports and utilities</a></li>
<li><a class="reference internal" href="#loading-the-data">Loading the data</a></li>
<li><a class="reference internal" href="#fit-models">Fit models</a></li>
<li><a class="reference internal" href="#sort-the-initialisation-by-their-sse">Sort the initialisation by their SSE</a></li>
<li><a class="reference internal" href="#examine-model-uniqueness">Examine model uniqueness</a></li>
<li><a class="reference internal" href="#plot-uniqueness-information">Plot uniqueness information</a></li>
<li><a class="reference internal" href="#scree-plot-of-fit-and-core-consistency">Scree plot of fit and core consistency</a></li>
<li><a class="reference internal" href="#core-element-plot">Core element plot</a></li>
<li><a class="reference internal" href="#split-half-analysis">Split-half analysis</a></li>
<li><a class="reference internal" href="#component-plots">Component plots</a><ul>
<li><a class="reference internal" href="#components">3 components</a></li>
<li><a class="reference internal" href="#id2">4 components</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    </aside>
    </div>

    

  </div>
  </div>

  <!-- Include here scripts that need to be added after the page is loaded -->
  <script>
    function toggle_sidebar() {
        var element = document.getElementById("sidebar");
        var container = document.getElementById("column-container");
        var localtoccolumn = document.getElementById("localtoc-column");
        element.classList.toggle("hide-tablet");
        element.classList.toggle("is-hidden-mobile");
        container.classList.toggle("sidemenu-hidden");
        localtoccolumn.classList.toggle("is-one-fifth-widescreen");
        localtoccolumn.classList.toggle("is-2-desktop");
        localtoccolumn.classList.toggle("is-3-desktop");
    }
  </script> 



  </body>
</html>